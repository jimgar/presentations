---
format: 
  revealjs:
    theme: [default, custom.scss]
    footer: "Data Team -- Culture Club -- Policy in Practice"
    embed-resources: false
    chalkboard: true
    link-external-icon: true
---

##  {background-color="#008849" background-image="images/title-slide-bg.png" background-position="left 0% bottom 0%" background-size="62% auto"}

![](images/twitter-green.webp){.absolute top=33% right=0 width="40%" height="auto"}

::: {.absolute bottom=35% left=1.5%}
Policy in Practice
:::

::: {.absolute bottom=15% right=0}
[Culture Club]{.big}
:::

::: {.absolute bottom=8% right=0}
Weds 25th Jan 2023
:::

::: footer

:::

## 

{{< video https://youtu.be/u_TwPhmFZ8E width="100%" height="85%" >}}

## Second

<!--# beep -->

::: incremental
-   I say
-   I said
:::

::: columns
::: {.column .fragment width="50%"}
Yoooo sup
:::

::: {.column .fragment width="50%"}
Suuuuuup dude
:::
:::

## Test

::: {.callout-note}
Note that there are five types of callouts, including:
`note`, `warning`, `important`, `tip`, and `caution`.
:::

::: {.callout-caution collapse="true"}
## Expand To Learn About Collapse

This is an example of a 'folded' caution callout that can be expanded by the user. You can use `collapse="true"` to collapse it by default or `collapse="false"` to make a collapsible callout that is expanded by default.
:::

## Employee reviews

### Blind

-   Scraped the title content of 900 Twitter employee reviews posted on [Blind](https://www.teamblind.com/)
-   Performed a simple **sentiment analysis**
    -   How positive or negative are the words being used
-   Plotted alongside the median score
    -   Where 1 ⭐️ = poor and 5 ⭐️ = great

## Twitter employee satisfaction

::: {style="font-size: 0.7em; text-align: center;"}
[Orange]{style="color: #e28743; text-decoration: underline;"} = sentiment
[Blue]{style="color: #063970; text-decoration: underline;"} = review score
:::

```{r}
#| fig-align: center
#| echo: true
#| code-fold: true
#| fig-height: 4
library(magrittr)
library(ggplot2)

pages <- file.path("pages", list.files(path = "pages", pattern = "*.html")) %>% 
  purrr::map(rvest::read_html)

reviews <- tibble::tibble(
  rating = purrr::map(
    pages,
    ~ rvest::html_elements(., ".num") %>% 
      rvest::html_text2() %>% 
      purrr::discard(stringr::str_detect(., "reviews")) %>% 
      stringr::str_remove("Rating Score") %>% 
      as.integer()
  ),
  text = purrr::map(
    pages, 
    ~ rvest::html_elements(., ".rvtit") %>% 
      rvest::html_text2() %>% 
      stringr::str_remove_all(., "”|“")
  ),
  date = purrr::map(
    pages, 
    ~ rvest::html_elements(., ".auth") %>% 
      rvest::html_text2() %>% 
      stringr::word(., -1, sep="- ") %>% 
      lubridate::mdy()
  )
) %>% 
  tibble::rowid_to_column(var = "page") %>% 
  tidyr::unnest(cols = c(rating, text, date)) %>% 
  tibble::rowid_to_column(var = "review_id")

tidy_reviews <- reviews %>% 
  tidytext::unnest_tokens(word, text)

bing_sentiments <- tidytext::get_sentiments("bing") %>% 
  tibble::add_row(word = "wlb", sentiment = "positive")

tidy_reviews <- tidy_reviews %>% 
  dplyr::anti_join(dplyr::filter(tidytext::stop_words, lexicon == "snowball"), by = "word") %>% 
  dplyr::inner_join(bing_sentiments, by = "word") %>% 
  dplyr::mutate(month = lubridate::floor_date(date, unit = "months"))

review_sentiments <- tidy_reviews %>% 
  dplyr::group_by(month) %>% 
  dplyr::summarise(median_rating = median(rating),
                   positive = length(sentiment[sentiment == "positive"]),
                   negative = length(sentiment[sentiment == "negative"]),
                   polarity = positive / negative)

dplyr::left_join(tidy_reviews, review_sentiments, by = "month") %>% 
  dplyr::filter(month > (dplyr::last(sort(unique(month))) - months(12))) %>%
  ggplot() +
  geom_line(aes(x = month, y = polarity), colour = "#e28743", linewidth = 1) +
  geom_line(aes(x = month, y = median_rating), colour = "#063970", linewidth = 1) +
  theme_minimal() +
  scale_y_continuous(name = "Score", n.breaks = 12) +
  scale_x_date(name = "Month", date_breaks = "1 months", date_labels = "%b %y") +
  theme(axis.text.x = element_text(angle = 45, hjust=1))
```

## Data {.scrollable}

::: {style="font-size: 0.7em;"}
```{r}
dplyr::select(reviews, c(rating, text, date)) %>% 
  reactable::reactable(
    showPageInfo = FALSE, 
    searchable = TRUE,
    defaultPageSize = 500,
    defaultColDef = reactable::colDef(
      align = "center",
      headerStyle = list(
        background = "#98ca45", 
        color = "#ffffff"
      )
    ),
    columns = list(
      # text = reactable::colDef(minWidth = 250),
      rating = reactable::colDef(maxWidth = 180),
      date = reactable::colDef(maxWidth = 200)
    ),
    bordered = TRUE,
    highlight = TRUE
  )
```
:::
